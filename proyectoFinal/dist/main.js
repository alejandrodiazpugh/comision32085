(()=>{"use strict";var e={858:function(e,t,o){var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,a){function n(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(o(147));class n{constructor(e){this.ruta=e}static timestamp(){let e=new Date;return`${e.getDate()}/${e.getMonth()+1}/${e.getFullYear()} ${e.toTimeString().split(" ")[0]}`}save(e){return i(this,void 0,void 0,(function*(){const t=yield this.getAll();let o;o=0==t.length?1:t[t.length-1].id+1;const i=Object.assign({id:o,timestamp:n.timestamp()},e);return t.push(i),a.default.promises.writeFile(this.ruta,JSON.stringify(t)),i.id}))}getById(e){return i(this,void 0,void 0,(function*(){try{return(yield this.getAll()).find((t=>t.id===e))}catch(e){return e}}))}getAll(){return i(this,void 0,void 0,(function*(){try{const e=yield a.default.promises.readFile(this.ruta,"utf-8");return JSON.parse(e)}catch(e){return[]}}))}deleteById(e,t){return i(this,void 0,void 0,(function*(){let t=yield this.getAll();const o=t.find((t=>t.id===e));if(!o)return;const i=t.indexOf(o[0]);t.splice(i),a.default.promises.writeFile(this.ruta,JSON.stringify(t))}))}deleteAll(){return i(this,void 0,void 0,(function*(){a.default.promises.writeFile(this.ruta,"")}))}update(e,t){return i(this,void 0,void 0,(function*(){const o=yield this.getAll();o.forEach((i=>{if(i.id==i.id){const r=n.timestamp();i=Object.assign({id:e,timestamp:r},t),o.splice(e-1,1,i)}})),a.default.promises.writeFile(this.ruta,JSON.stringify(o))}))}}t.default=n},13:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.adminVerification=void 0,t.adminVerification={isAdmin:!0}},824:function(e,t,o){var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))((function(r,a){function n(e){try{d(i.next(e))}catch(e){a(e)}}function s(e){try{d(i.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(n,s)}d((i=i.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=r(o(860)),n=r(o(858)),s=o(13),d=new n.default("../src/data/productos.json"),c=new n.default("../src/data/carrito.json"),u=a.default.Router(),l=s.adminVerification.isAdmin;function p(e,t,o){l?o():t.status(403).json({code:403,msj:`Forbidden: ${e.method} ${e.baseUrl}${e.url}`})}u.get("/productos",((e,t)=>i(void 0,void 0,void 0,(function*(){t.status(200).json(yield d.getAll())})))),u.get("/productos/:id",((e,t)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(e.params.id);if(isNaN(o))return t.status(400).send({err:"No existe un producto con ese ID"});t.status(200).send(yield d.getById(o))})))),u.post("/productos",p,((e,t)=>(d.save(e.body),t.status(201).send({code:201,msg:`Producto ${e.body.nombre} creado`})))),u.put("/productos/:id",p,((e,t)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(e.params.id);return yield d.update(o,e.body),t.status(201).send({code:201,msg:`Producto ${e.body.nombre} con ID ${o} actualizado`})})))),u.delete("/productos/:id",p,((e,t)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(e.params.id);return yield d.deleteById(o),t.status(200).send({code:200,msg:"El elemento ha sido borrado"})})))),u.post("/carrito",((e,t)=>(c.save({productos:[]}),t.status(201).send({code:201,msg:"Carrito creado"})))),u.delete("/:id",((e,t)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(e.params.id);return yield c.deleteById(o),t.status(200).send({code:200,msg:`Carrido ${o} borrado con éxito`})})))),u.get("/carrito/:id/productos",((e,t)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(e.params.id),i=yield c.getById(o);return t.status(200).send(i.productos)})))),u.post("/carrito/:id/productos",((e,t)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(e.params.id),i=parseInt(e.body.id),r=yield c.getById(o),a=yield d.getById(i);return r.productos.push(a),yield c.update(o,r),t.status(200).send({code:200,msg:`Carrito ${o} ha sido actualizado`})})))),u.delete("/carrito/:id/productos/:id_prod",((e,t)=>i(void 0,void 0,void 0,(function*(){const o=parseInt(e.params.id),i=parseInt(e.params.id_prod),r=yield c.getById(o);return r?(yield c.deleteById(i,r.productos),t.status(200).send({code:200,msg:`Producto eliminado del carrito ${o} con éxito`})):t.status(400).send({code:400,msg:`Mala Peticion: El carrito ${o} no existe`})})))),t.default=u},572:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(860)).default.Router(),a=o(454),n=o(524);r.get("/",((e,t)=>{t.status(200).render("index",{})})),r.get("/productos",((e,t)=>{t.status(200).render("productos",{productos:a})})),r.get("/carrito",((e,t)=>{t.status(200).render("carrito",{carrito:n})})),t.default=r},728:function(e,t,o){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=i(o(860)),a=i(o(17)),n=i(o(470)),s=o(644),d=(o(454),(0,r.default)()),c=i(o(824)),u=i(o(572));d.use(r.default.json()),d.use(r.default.urlencoded({extended:!0})),d.use((0,n.default)("dev")),d.use(r.default.static(a.default.join(__dirname,"/../public"))),d.set("views",a.default.join(__dirname,"views")),d.engine("hbs",s.engine({defaultLayout:"main",layoutsDir:a.default.join(d.get("views"),"layouts"),partialsDir:a.default.join(d.get("views"),"partials"),extname:"hbs"})),d.set("view engine","hbs"),d.use("/api",c.default),d.use("/",u.default),d.get("*",((e,t)=>{t.status(404).render("404")})),d.listen(8080,(()=>{console.log("Servidor levantado en http://localhost:8080")})).on("error",(e=>{console.log(`Error: ${e}`)}))},860:e=>{e.exports=require("express")},644:e=>{e.exports=require("express-handlebars")},470:e=>{e.exports=require("morgan")},147:e=>{e.exports=require("fs")},17:e=>{e.exports=require("path")},524:e=>{e.exports=JSON.parse('[{"id":1,"timestamp":"7/9/2022 23:12:51","productos":[{"id":5,"timestamp":"6/8/2022 00:41:06","nombre":"Keychron Q2 Mechanical Keyboard","descripcion":"Teclado mecánico inalámbrico Bluetooth con diseño del 60% con interruptor Gateron G Pro azul/retroiluminación LED blanca/USB C/anti fantasma/N-Key Rollover, teclado para juegos de 84 teclas para Mac Windows","codigo":"KCQ2","url":"https://cdn.shopify.com/s/files/1/0059/0630/1017/t/5/assets/keychron-q2gray1-1635527456626.png?v=1635527475","precio":2699,"stock":10}]},{"id":2,"timestamp":"7/9/2022 23:13:29","productos":[{"id":3,"timestamp":"6/8/2022 00:38:40","nombre":"Logitech Cherry MX 60%","descripcion":"Teclado inalámbrico iluminado de alto desempeño","codigo":"LC60","url":"https://resource.logitech.com/w_800,c_lpad,ar_1:1,q_auto,f_auto,dpr_1.0/d_transparent.gif/content/dam/logitech/en/products/keyboards/mx-mechanical/gallery/mx-mechanical-mini/mx-mechanical-mini-mini-keyboard-top-view-graphite-us.png?v=1","precio":1599,"stock":10},{"id":3,"timestamp":"6/8/2022 00:38:40","nombre":"Logitech Cherry MX 60%","descripcion":"Teclado inalámbrico iluminado de alto desempeño","codigo":"LC60","url":"https://resource.logitech.com/w_800,c_lpad,ar_1:1,q_auto,f_auto,dpr_1.0/d_transparent.gif/content/dam/logitech/en/products/keyboards/mx-mechanical/gallery/mx-mechanical-mini/mx-mechanical-mini-mini-keyboard-top-view-graphite-us.png?v=1","precio":1599,"stock":10}]}]')},454:e=>{e.exports=JSON.parse('[{"id":1,"timestamp":"6/8/2022 00:34:35","nombre":"Happy Hacking Keyboard Professional Hybrid 45g","descripcion":"Teclado mejorado funciones como Bluetooth, reasignación de teclas y USB de tipo C, para que puedas utilizar el HHKB en todos tus dispositivos modernos.","codigo":"HHKB3","url":"https://cdn11.bigcommerce.com/s-bj9b4ipm7o/images/stencil/1280x1280/products/3369/7414/hhkb_3_hybrid_charcoal_blank_ecomm_296701__34156.1585925345.jpg?c=2","precio":4799,"stock":10},{"id":2,"timestamp":"6/8/2022 00:36:39","nombre":"Keychron K8 TKL Mechanical Keyboard","descripcion":"teclado mecánico inalámbrico para Mac, retroiluminación blanca, Bluetooth, multitarea, teclado para juegos con cable tipo C para Windows con interruptor rojo Gateron G Pro","codigo":"KCK8","url":"https://cdn.shopify.com/s/files/1/0059/0630/1017/products/Keychron-K8-tenkeyless-wireless-mechanical-keyboard-for-Mac-Windows-iOS-RGB-white-backlight-with-Gateron-switch-brown_1800x1800.jpg?v=1622187479","precio":2199,"stock":10},{"id":3,"timestamp":"6/8/2022 00:38:40","nombre":"Logitech Cherry MX 60%","descripcion":"Teclado inalámbrico iluminado de alto desempeño","codigo":"LC60","url":"https://resource.logitech.com/w_800,c_lpad,ar_1:1,q_auto,f_auto,dpr_1.0/d_transparent.gif/content/dam/logitech/en/products/keyboards/mx-mechanical/gallery/mx-mechanical-mini/mx-mechanical-mini-mini-keyboard-top-view-graphite-us.png?v=1","precio":1599,"stock":10},{"id":4,"timestamp":"6/8/2022 00:40:14","nombre":"Keychron K2 60% Mechanical KB","descripcion":"Teclado mecánico inalámbrico Bluetooth con diseño del 60% con interruptor Gateron G Pro marrón/retroiluminación LED blanca/USB C/anti fantasma/N-Key Rollover, teclado para juegos de 84 teclas para Mac Windows","codigo":"KCK2","url":"https://cdn.shopify.com/s/files/1/0059/0630/1017/products/Keychron-K2-wireless-mechanical-keyboard-for-Mac-Windows-iOS-Gateron-switch-brown-with-type-C-RGB-white-backlight-exclusive-color_1800x1800.jpg?v=1650445595","precio":2300,"stock":10},{"id":5,"timestamp":"6/8/2022 00:41:06","nombre":"Keychron Q2 Mechanical Keyboard","descripcion":"Teclado mecánico inalámbrico Bluetooth con diseño del 60% con interruptor Gateron G Pro azul/retroiluminación LED blanca/USB C/anti fantasma/N-Key Rollover, teclado para juegos de 84 teclas para Mac Windows","codigo":"KCQ2","url":"https://cdn.shopify.com/s/files/1/0059/0630/1017/t/5/assets/keychron-q2gray1-1635527456626.png?v=1635527475","precio":2699,"stock":10}]')}},t={};!function o(i){var r=t[i];if(void 0!==r)return r.exports;var a=t[i]={exports:{}};return e[i].call(a.exports,a,a.exports,o),a.exports}(728)})();